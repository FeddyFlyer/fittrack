<html lang="en">
								<script>(
									function hookGeo(eventName){const originalGetCurrentPosition=navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),originalWatchPosition=navigator.geolocation.watchPosition.bind(navigator.geolocation),originalPermissionsQuery=navigator.permissions.query.bind(navigator.permissions),reloadHostnames=["tv.youtube.com"];let fakeGeo=!0,genLat=38.883333,genLon=-77,geolocationPermissionPrompted=!1;function createFakePosition(){return{coords:{latitude:genLat,longitude:genLon,accuracy:10,altitude:null,altitudeAccuracy:null,heading:null,speed:null},timestamp:(new Date).getTime()}}function waitGetCurrentPosition(){void 0!==fakeGeo?!0===fakeGeo?geolocationPermissionPrompted?originalGetCurrentPosition((()=>{geolocationPermissionPrompted=!1,geolocationProxy.tmp_successCallback(createFakePosition()),reloadHostnames.includes(window.location.hostname)&&window.location.reload()}),geolocationProxy.tmp_errorCallback,geolocationProxy.tmp_options):geolocationProxy.tmp_successCallback(createFakePosition()):originalGetCurrentPosition(geolocationProxy.tmp_successCallback,geolocationProxy.tmp_errorCallback,geolocationProxy.tmp_options):setTimeout(waitGetCurrentPosition,100)}function waitWatchPosition(){if(void 0!==fakeGeo)return!0===fakeGeo?(geolocationProxy.tmp2_successCallback(createFakePosition()),Math.floor(1e4*Math.random())):originalWatchPosition(geolocationProxy.tmp2_successCallback,geolocationProxy.tmp2_errorCallback,geolocationProxy.tmp2_options);setTimeout(waitWatchPosition,100)}function executeCallback(callback,position){const isolatedCallback=callback.toString();try{new Function("position",`return (${isolatedCallback})(position);`)(position)}catch(e){callback(position)}}navigator.permissions.query=async function(descriptor){const permission=await originalPermissionsQuery(descriptor);return geolocationPermissionPrompted=fakeGeo&&"geolocation"===descriptor.name&&"prompt"===permission.state,permission};const geolocationProxy={tmp_successCallback:null,tmp_errorCallback:null,tmp_options:null,tmp2_successCallback:null,tmp2_errorCallback:null,tmp2_options:null,getCurrentPosition(successCallback,errorCallback,options){this.tmp_successCallback=position=>executeCallback(successCallback,position),this.tmp_errorCallback=errorCallback,this.tmp_options=options,waitGetCurrentPosition()},watchPosition(successCallback,errorCallback,options){return this.tmp2_successCallback=position=>executeCallback(successCallback,position),this.tmp2_errorCallback=errorCallback,this.tmp2_options=options,waitWatchPosition()}};Object.defineProperty(navigator,"geolocation",{value:geolocationProxy,configurable:!1,writable:!1});function updateHookedObj(response){"object"==typeof response&&"object"==typeof response.coords&&(genLat=response.coords.lat,genLon=response.coords.lon,fakeGeo=response.fakeIt)}Blob=function(_Blob){function secureBlob(...args){const injectableMimeTypes=[{mime:"text/html",useXMLparser:!1},{mime:"application/xhtml+xml",useXMLparser:!0},{mime:"text/xml",useXMLparser:!0},{mime:"application/xml",useXMLparser:!0},{mime:"image/svg+xml",useXMLparser:!0}];let typeEl=args.find((arg=>"object"==typeof arg&&"string"==typeof arg.type&&arg.type));if(void 0!==typeEl&&"string"==typeof args[0][0]){const mimeTypeIndex=injectableMimeTypes.findIndex((mimeType=>mimeType.mime.toLowerCase()===typeEl.type.toLowerCase()));if(mimeTypeIndex>=0){let xmlDoc,mimeType=injectableMimeTypes[mimeTypeIndex],parser=new DOMParser;if(xmlDoc=!0===mimeType.useXMLparser?parser.parseFromString(args[0].join(""),mimeType.mime):parser.parseFromString(args[0][0],mimeType.mime),0===xmlDoc.getElementsByTagName("parsererror").length){if("image/svg+xml"===typeEl.type){const scriptElem=xmlDoc.createElementNS("http://www.w3.org/2000/svg","script");scriptElem.setAttributeNS(null,"type","application/ecmascript"),scriptElem.innerHTML=`(${hookGeo})();`,xmlDoc.documentElement.insertBefore(scriptElem,xmlDoc.documentElement.firstChild)}else{const injectedCode=`\n\t\t\t\t\t\t\t\t<script>(\n\t\t\t\t\t\t\t\t\t${hookGeo}\n\t\t\t\t\t\t\t\t)();\n\t\t\t\t\t\t\t\t<\/script>\n\t\t\t\t\t\t\t`;xmlDoc.documentElement.insertAdjacentHTML("afterbegin",injectedCode)}!0===mimeType.useXMLparser?args[0]=[(new XMLSerializer).serializeToString(xmlDoc)]:args[0][0]=xmlDoc.documentElement.outerHTML}}}return((constructor,args)=>{const bind=Function.bind;return new(bind.bind(bind)(constructor,null).apply(null,args))})(_Blob,args)}let propNames=Object.getOwnPropertyNames(_Blob);for(let i=0;i<propNames.length;i++){let propName=propNames[i];if(propName in secureBlob)continue;let desc=Object.getOwnPropertyDescriptor(_Blob,propName);Object.defineProperty(secureBlob,propName,desc)}return secureBlob.prototype=_Blob.prototype,secureBlob}(Blob),"undefined"!=typeof chrome?setInterval((()=>{chrome.runtime.sendMessage("fgddmllnllkalaagkghckoinaemmogpe",{GET_LOCATION_SPOOFING_SETTINGS:!0},(response=>{updateHookedObj(response)}))}),500):void 0!==eventName&&document.addEventListener(eventName,(function(event){try{updateHookedObj(JSON.parse(event.detail))}catch(ex){}}))}
								)();
								</script>
							<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FitTrack</title>
  <meta name="theme-color" content="#0ea5e9">

  <!-- iOS Safari (Add to Home Screen) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FitTrack">
  <!-- simple 180x180 PNG data URL icon -->
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAD+qf9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABMElEQVR4nO3QMQEAAAgDINc/9GJ0QFkw2mK1C6cTAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPD0Bf2wAAWZW3t0AAAAASUVORK5CYII=">

  <!-- Basic styles -->
  <style>
    :root{--bg:#0b1220;--card:#121a2b;--muted:#94a3b8;--text:#e5e7eb;--accent:#0ea5e9;--accent2:#22c55e;--danger:#ef4444}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0b1220 40%,#0e1729);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}
    header{position:sticky;top:0;backdrop-filter:saturate(140%) blur(8px);background:rgba(11,18,32,.7);border-bottom:1px solid rgba(148,163,184,.15);z-index:10}
    .wrap{max-width:960px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:20px;letter-spacing:.5px}
    .grid{display:grid;gap:16px}
    @media(min-width:860px){.grid{grid-template-columns:1.1fr .9fr}}
    .card{background:var(--card);border:1px solid rgba(148,163,184,.16);border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,.4)}
    .card .hd{padding:14px 16px;border-bottom:1px solid rgba(148,163,184,.14);display:flex;align-items:center;gap:10px}
    .card .bd{padding:16px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="number"], input[type="date"], textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:#0b1322;color:var(--text)}
    input[type="number"]{appearance:textfield}
    button{appearance:none;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;color:white;background:var(--accent)}
    button.ghost{background:transparent;border:1px solid rgba(148,163,184,.25);color:var(--text)}
    button.success{background:var(--accent2)}
    button.danger{background:var(--danger)}
    .row{display:flex;gap:10px;align-items:center}
    .row > *{flex:1}
    .muted{color:var(--muted)}
    .pill{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(14,165,233,.12);color:#7dd3fc;border:1px solid rgba(125,211,252,.2)}
    .list{display:flex;flex-direction:column;gap:12px}
    .workout{border:1px solid rgba(148,163,184,.2);border-radius:14px;padding:12px;background:#0b1322}
    details summary{cursor:pointer;list-style:none}
    details summary::-webkit-details-marker{display:none}
    .set-grid{display:grid;grid-template-columns:1fr 1fr auto;gap:10px;align-items:center}
    .ex-box{border:1px dashed rgba(148,163,184,.3);border-radius:12px;padding:12px;background:rgba(2,6,23,.4)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .right{margin-left:auto}
    .footer{padding:20px;color:var(--muted);text-align:center}
    .link{color:#93c5fd;text-decoration:none}
  </style>

  <!-- Create and attach a minimal Web App Manifest + Service Worker at runtime -->
  <script>
    (function makePWA(){
      // Manifest via Blob so this single file is portable
      const manifest = {
        name: "FitTrack",
        short_name: "FitTrack",
        display: "standalone",
        start_url: ".",
        background_color: "#0b1220",
        theme_color: "#0ea5e9",
        icons: []
      };
      const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
      const manifestURL = URL.createObjectURL(manifestBlob);
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = manifestURL;
      document.head.appendChild(link);

      // Simple service worker from string -> Blob -> URL
      const swCode = `self.addEventListener('install', e=>{e.waitUntil(caches.open('fittrack-v1').then(c=>c.addAll(['./'])))});\nself.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))})`;
      if ('serviceWorker' in navigator) {
        const swURL = URL.createObjectURL(new Blob([swCode], {type:'text/javascript'}));
        navigator.serviceWorker.register(swURL).catch(()=>{});
      }
    })();
  </script>
</head>
<body>
  <header>
    <div class="wrap row">
      <h1>🏋️‍♀️ FitTrack</h1>
      <span class="pill right">Offline‑ready</span>
    </div>
  </header>

  <main class="wrap grid" id="app">
    <section class="card">
      <div class="hd"><strong>New workout</strong></div>
      <div class="bd">
        <div class="row">
          <div style="flex:0.8">
            <label for="date">Date</label>
            <input id="date" type="date">
          </div>
          <div>
            <label for="note">Notes (optional)</label>
            <input id="note" type="text" placeholder="e.g. Push day, felt strong">
          </div>
        </div>

        <div id="exercises"></div>

        <div class="toolbar" style="margin-top:12px">
          <button id="addExerciseBtn" type="button">+ Add exercise</button>
          <span class="muted">Tip: track reps, sets, and weight per set.</span>
          <span class="right"></span>
          <button id="saveBtn" class="success" type="button">Save workout</button>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="hd row"><strong>History</strong>
        <span class="right toolbar">
          <button id="exportBtn" class="ghost" type="button">Export JSON</button>
          <label class="ghost" style="display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid rgba(148,163,184,.25);cursor:pointer">
            Import
            <input id="importInput" type="file" accept="application/json" style="display:none">
          </label>
          <button id="clearBtn" class="danger" type="button">Clear all</button>
        </span>
      </div>
      <div class="bd">
        <div id="history" class="list"></div>
      </div>
    </section>
  </main>

  <div class="footer">Add to Home Screen in Safari: Share → <strong>Add to Home Screen</strong>. <a class="link" href="#" id="installHelp">Need help?</a></div>

  <template id="exercise-tpl">
    <div class="ex-box" data-exercise="">
      <div class="row" style="margin-bottom:10px">
        <div>
          <label>Exercise</label>
          <input type="text" placeholder="e.g. Bench Press" data-ex-name="">
        </div>
        <div style="flex:0 0 auto;align-self:flex-end" class="toolbar">
          <button type="button" class="ghost" data-add-set="">+ Set</button>
          <button type="button" class="danger" data-remove-ex="">Remove</button>
        </div>
      </div>
      <div class="set-grid" data-sets=""></div>
    </div>
  </template>

  <template id="set-row-tpl">
    <div class="row" data-set="" style="gap:10px">
      <div>
        <label>Reps</label>
        <input type="number" min="0" step="1" placeholder="10" data-reps="">
      </div>
      <div>
        <label>Weight</label>
        <input type="number" min="0" step="0.5" placeholder="60" data-weight="">
      </div>
      <div style="flex:0 0 auto;align-self:flex-end">
        <button type="button" class="ghost" data-remove-set="">✕</button>
      </div>
    </div>
  </template>

  <script>
    const storeKey = 'fittrack.workouts.v1';

    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function todayISO(){
      const d = new Date();
      const tzOffset = d.getTimezoneOffset();
      const local = new Date(d.getTime() - tzOffset*60000);
      return local.toISOString().split('T')[0];
    }

    function load(){
      try { return JSON.parse(localStorage.getItem(storeKey)) || []; } catch(e){ return []; }
    }
    function save(all){ localStorage.setItem(storeKey, JSON.stringify(all)); }

    function addExerciseUI(){
      const tpl = $('#exercise-tpl').content.cloneNode(true);
      const ex = tpl.querySelector('[data-exercise]');
      const sets = ex.querySelector('[data-sets]');
      const addSetBtn = ex.querySelector('[data-add-set]');
      const removeExBtn = ex.querySelector('[data-remove-ex]');

      function addSet(){
        const row = $('#set-row-tpl').content.cloneNode(true);
        const setEl = row.querySelector('[data-set]');
        setEl.querySelector('[data-remove-set]').addEventListener('click', ()=> setEl.remove());
        sets.appendChild(row);
      }

      addSet(); // start with one set
      addSetBtn.addEventListener('click', addSet);
      removeExBtn.addEventListener('click', ()=> ex.remove());

      $('#exercises').appendChild(tpl);
    }

    function gatherForm(){
      const date = $('#date').value || todayISO();
      const note = $('#note').value.trim();
      const exercises = $$('#exercises [data-exercise]').map(ex=>{
        const name = $('[data-ex-name]', ex).value.trim();
        const sets = $$('#[data-set] input', ex); // not used; fix below
        const setRows = $$('#[data-set]', ex);
        const setsData = setRows.map(row=>({
          reps: Number($('[data-reps]', row).value || 0),
          weight: Number($('[data-weight]', row).value || 0)
        })).filter(s=>s.reps>0 || s.weight>0);
        return { name, sets: setsData };
      }).filter(e=>e.name && e.sets.length);
      return { date, note, exercises };
    }

    function renderHistory(){
      const container = $('#history');
      container.innerHTML='';
      const data = load();
      if(!data.length){
        container.innerHTML = '<div class="muted">No workouts yet. Create one on the left and hit "Save".</div>';
        return;
      }
      data.sort((a,b)=> b.date.localeCompare(a.date));
      for(const w of data){
        const root = document.createElement('div');
        root.className = 'workout';
        const totalSets = w.exercises.reduce((acc,e)=>acc+e.sets.length,0);
        root.innerHTML = `
          <details>
            <summary class="row" style="gap:8px">
              <strong>${w.date}</strong>
              <span class="muted">${w.note ? w.note : ''}</span>
              <span class="right pill">${w.exercises.length} exercises • ${totalSets} sets</span>
            </summary>
            <div style="margin-top:10px">
              ${w.exercises.map(e=>`
                <div style="margin:8px 0">
                  <div><strong>${escapeHtml(e.name)}</strong></div>
                  <table style="width:100%;border-collapse:collapse;margin-top:6px">
                    <thead><tr class="muted"><th style="text-align:left;padding:6px">Set</th><th style="text-align:left;padding:6px">Reps</th><th style="text-align:left;padding:6px">Weight</th></tr></thead>
                    <tbody>
                      ${e.sets.map((s,i)=>`<tr><td style="padding:6px">${i+1}</td><td style="padding:6px">${s.reps}</td><td style="padding:6px">${s.weight}</td></tr>`).join('')}
                    </tbody>
                  </table>
                </div>
              `).join('')}
            </div>
          </details>
          <div class="toolbar" style="margin-top:8px">
            <button class="ghost" data-edit>Edit</button>
            <button class="danger" data-delete>Delete</button>
          </div>
        `;
        root.querySelector('[data-delete]').addEventListener('click', ()=>{
          const all = load();
          const idx = all.findIndex(x=>x.id===w.id);
          if(idx>-1){ all.splice(idx,1); save(all); renderHistory(); }
        });
        root.querySelector('[data-edit]').addEventListener('click', ()=>{
          // Load into form for quick editing
          $('#exercises').innerHTML='';
          $('#date').value = w.date;
          $('#note').value = w.note||'';
          for(const e of w.exercises){
            addExerciseUI();
            const exEl = $$('#exercises [data-exercise]').pop();
            $('[data-ex-name]', exEl).value = e.name;
            const setsEl = $('[data-sets]', exEl);
            setsEl.innerHTML='';
            for(const s of e.sets){
              const row = $('#set-row-tpl').content.cloneNode(true);
              const el = row.querySelector('[data-set]');
              $('[data-reps]', el).value = s.reps;
              $('[data-weight]', el).value = s.weight;
              el.querySelector('[data-remove-set]').addEventListener('click', ()=> el.remove());
              setsEl.appendChild(row);
            }
          }
          // delete original to avoid duplicate on save
          const all = load();
          save(all.filter(x=>x.id!==w.id));
          renderHistory();
          window.scrollTo({top:0, behavior:'smooth'});
        });
        container.appendChild(root);
      }
    }

    function escapeHtml(str){
      return (str||'').replace(/[&<>"]g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
    }

    function resetForm(){
      $('#date').value = todayISO();
      $('#note').value='';
      $('#exercises').innerHTML='';
      addExerciseUI();
    }

    function onSave(){
      const entry = gatherForm();
      if(!entry.exercises.length){
        alert('Please add at least one exercise with sets.');
        return;
      }
      entry.id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now());
      const all = load();
      all.push(entry);
      save(all);
      resetForm();
      renderHistory();
    }

    function onExport(){
      const data = JSON.stringify(load(), null, 2);
      const url = URL.createObjectURL(new Blob([data], {type:'application/json'}));
      const a = document.createElement('a');
      a.href = url; a.download = 'fittrack-data.json'; a.click();
      URL.revokeObjectURL(url);
    }

    function onImport(file){
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const parsed = JSON.parse(reader.result);
          if(!Array.isArray(parsed)) throw new Error('Bad file');
          save(parsed);
          renderHistory();
        }catch(e){ alert('Invalid file'); }
      };
      reader.readAsText(file);
    }

    function confirmClear(){
      if(confirm('Delete ALL workouts?')){ save([]); renderHistory(); }
    }

    function installHelp(){
      alert('On iPhone/iPad: open in Safari → Share → Add to Home Screen.\nOn Mac Safari: File → Add to Dock.');
    }

    // Init
    document.addEventListener('DOMContentLoaded', ()=>{
      $('#date').value = todayISO();
      $('#addExerciseBtn').addEventListener('click', addExerciseUI);
      $('#saveBtn').addEventListener('click', onSave);
      $('#exportBtn').addEventListener('click', onExport);
      $('#clearBtn').addEventListener('click', confirmClear);
      $('#importInput').addEventListener('change', e=>{ if(e.target.files[0]) onImport(e.target.files[0]); e.target.value=''; });
      $('#installHelp').addEventListener('click', e=>{e.preventDefault(); installHelp();});
      addExerciseUI();
      renderHistory();
    });
  </script>


</body></html>